(window.webpackJsonp=window.webpackJsonp||[]).push([[418],{2014:function(e,t,n){"use strict";n.r(t);var r=n(0),d=(n(19),n(227),n(23),n(16),n(135)),o=n(175),l=n(21),m=n(22),c=n.n(m);function v(){return w.apply(this,arguments)}function w(){return w=Object(r.a)(regeneratorRuntime.mark((function e(){var t,n,r,d,data,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:0,l.a.debug("Handling UserSignup UTM params"),!(t>30)){e.next=6;break}throw new Error("Failed to set up user");case 6:t++;case 7:return e.next=9,new Promise((function(e){return setTimeout(e,1e3)}));case 9:if(n=window.$nuxt.$api){e.next=12;break}return e.abrupt("return");case 12:if(r={utm_source:c.a.get("utm_source")||"empty",utm_medium:c.a.get("utm_medium")||"(not set)",utm_campaign:c.a.get("utm_campaign")||null},0!==Object.keys(r).length){e.next=15;break}return e.abrupt("return");case 15:return e.prev=15,e.next=18,n.get("/api/v3/users/me");case 18:return d=e.sent,data=d.data,e.next=22,n.patch("/api/v3/users/".concat(data.id,"/setup"),r);case 22:e.next=30;break;case 24:if(e.prev=24,e.t0=e.catch(15),e.t0.response){e.next=28;break}throw e.t0;case 28:if(404!==e.t0.response.status){e.next=30;break}return e.abrupt("return",v(t));case 30:case"end":return e.stop()}}),e,null,[[15,24]])}))),w.apply(this,arguments)}o.a.$on(d.a.UserSignedIn,(function(e){var t,n,r=e.user,m=e.method,v=e.enterprise,w=e.track_analytics,_=void 0===w||w;l.a.debug("Handling UserSignedIn",r);var h="user_".concat(r.attributes.sub);if(_&&o.a.$emit(d.a.AnalyticsGA4Event,{event:"login",userId:h,method:m}),null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser({id:h,email:r.attributes.email}),c.a.remove("unauthed_cart"),!v.is_whitelabel){var f=r.attributes.given_name||void 0;window.Intercom("boot",{name:f||void 0,app_id:"fuchdm6u",user_id:h,email:r.attributes.email,eid:v.id})}})),o.a.$on(d.a.UserRegistered,(function(e){var t,n,r=e.user,m=e.method,v=e.enterprise;l.a.debug("Handling UserRegistered",r);var w="user_".concat(r.attributes.sub);if(o.a.$emit(d.a.AnalyticsGA4Event,{event:"sign_up",userId:w,method:m}),null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser({id:w,email:r.attributes.email}),c.a.remove("unauthed_cart"),!v.is_whitelabel){var _=r.attributes.given_name||void 0;window.Intercom("boot",{app_id:"fuchdm6u",user_id:w,name:_,email:r.attributes.email,eid:v.id})}})),o.a.$on(d.a.UserUpdatedAttributes,(function(e){var t,n,r=e.user,d=e.enterprise;l.a.debug("Handling UserUpdatedAttributes",r),c.a.remove("unauthed_cart"),d.is_whitelabel||(r.given_name||r.family_name)&&(null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser({id:r.id,email:r.email}),window.Intercom("update",{name:r.given_name+" "+r.family_name}))})),o.a.$on(d.a.UserSignedOut,(function(e){var t,n,r=e.enterprise;l.a.debug("Handling UserSignedOut"),null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser(null),r.is_whitelabel||window.Intercom("shutdown")})),o.a.$on(d.a.UserRegistered,v)}}]);